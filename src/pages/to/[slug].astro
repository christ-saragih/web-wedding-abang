---
export const prerender = false;

import Layout from '../../layouts/Layout.astro';
import Navbar from '../../components/Navbar.astro';
import Hero from '../../components/Hero.astro';
import OurStory from '../../components/OurStory.astro';
import AdatSection from '../../components/AdatSection.astro';
import EventDetails from '../../components/EventDetails.astro';
import Gallery from '../../components/Gallery.astro';
import GuestWishes from '../../components/GuestWishes.astro';
import RSVP from '../../components/RSVP.astro';
import Footer from '../../components/Footer.astro';
import CoupleSection from '../../components/CoupleSection.astro';
import { supabase } from '../../lib/supabase.client';

// Ambil slug dari URL
const { slug } = Astro.params;

let guestName = "Tamu Spesial";

if (slug) {
  // Pastikan slug lowercase agar match dengan database
  const safeSlug = slug.toLowerCase();
  
  console.log("Fetching guest for slug:", safeSlug);

  const { data, error } = await supabase
    .from('guests')
    .select('name')
    .eq('slug', safeSlug)
    .single();
  
  if (error) {
    console.error("Error fetching guest:", error);
  }
  
  if (data) {
    console.log("Guest found:", data.name);
    guestName = data.name;
  } else {
    console.log("No guest found");
  }
}
---

<Layout 
  title={`Undangan Pernikahan Bagas & Firda untuk ${guestName}`}
  description="Kami mengundang kamu untuk turut berbagi kebahagiaan dalam pernikahan kami."
>
  <Navbar />
  <main>
    <!-- Pass guestName ke Hero -->
    <Hero guestName={guestName} />
    <CoupleSection />
    <OurStory />
    <AdatSection />
    <EventDetails />
    <Gallery />
    <GuestWishes />
    <RSVP />
  </main>
  <Footer />
</Layout>