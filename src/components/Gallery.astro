---
import { cn } from "@/lib/utils";
import { ImagesIcon } from "@phosphor-icons/react";


// Gallery Section - Galeri Foto
// Updated to support "Load More" behavior: show first 9, reveal all on button click.
// Add new images by appending to the `images` array below.

type ImageItem = {
  src: string;
  alt: string;
  caption: string;
  size: "tall" | "medium" | "short";
  imgClass?: string;
};

const INITIAL_COUNT = 9;

// Source of truth for gallery items. Add more photos here when available.
const images: ImageItem[] = [
  { src: "/images/gallery/1.jpg", alt: "Momen Bahagia Kami", caption: "Momen Bahagia Kami", size: "tall", imgClass: "object-[50%_70%]" },
  { src: "/images/gallery/2.jpg", alt: "Bersama Keluarga", caption: "Bersama Keluarga", size: "short", imgClass: "object-[50%_52%]" },
  { src: "/images/gallery/3.jpg", alt: "Senyuman Cinta", caption: "Senyuman Cinta", size: "medium", imgClass: "object-[50%_65%]" },
  { src: "/images/gallery/4.jpg", alt: "Kebersamaan", caption: "Kebersamaan", size: "medium" },
  { src: "/images/gallery/5.jpg", alt: "Tawa & Canda", caption: "Tawa & Canda", size: "short" },
  { src: "/images/gallery/6.jpg", alt: "Petualangan Berdua", caption: "Petualangan Berdua", size: "tall" },
  { src: "/images/gallery/7.jpg", alt: "Kenangan Indah", caption: "Kenangan Indah", size: "short", imgClass: "object-[50%_65%]" },
  { src: "/images/gallery/8.jpg", alt: "Langkah Bersama", caption: "Langkah Bersama", size: "tall" },
  { src: "/images/gallery/9.jpg", alt: "Selamanya", caption: "Selamanya", size: "medium", imgClass: "object-[50%_60%]" },
  { src: "/images/gallery/10.jpg", alt: "Selamanya", caption: "Selamanya", size: "short", imgClass: "object-[50%_60%]" },
  { src: "/images/gallery/11.jpg", alt: "Selamanya", caption: "Selamanya", size: "medium", imgClass: "object-[50%_80%]" },
  { src: "/images/gallery/12.jpg", alt: "Selamanya", caption: "Selamanya", size: "short", imgClass: "object-[50%_45%]" },
  { src: "/images/gallery/13.jpg", alt: "Selamanya", caption: "Selamanya", size: "tall", imgClass: "object-[50%_60%]" },
  { src: "/images/gallery/14.jpg", alt: "Selamanya", caption: "Selamanya", size: "medium", imgClass: "object-[50%_80%]" },
  { src: "/images/gallery/15.jpg", alt: "Selamanya", caption: "Selamanya", size: "medium", imgClass: "object-[50%_75%]" },
];

const hasMore = images.length > INITIAL_COUNT;

// Distribute images into 3 masonry columns for a balanced layout
const columns = 3;
const cols: ImageItem[][] = Array.from({ length: columns }, () => []);
images.forEach((img, idx) => {
  cols[idx % columns].push(img);
});
---

<section id="gallery" class="py-20 px-4 bg-dark" data-initial-count={INITIAL_COUNT}>
  <div class="max-w-7xl mx-auto">
    <!-- Section Title -->
    <div class="text-center mb-16 fade-in">
      <h2 class="font-heading text-4xl md:text-5xl font-bold text-gold mb-4">
        Galeri Kami
      </h2>
      <div class="w-24 h-1 bg-gold mx-auto mb-6"></div>
      <p class="text-cream/80 text-lg">
        Momen indah dalam perjalanan kami
      </p>
    </div>

    <!-- Gallery Masonry Grid -->
    <div class="masonry-grid">
      {cols.map((col: ImageItem[], colIdx: number) => (
        <div class="masonry-column" data-col={colIdx}>
          {col.map((img: ImageItem, localIdx: number) => {
            const idx = colIdx + localIdx * columns; // recover original order index
            const isHidden = idx >= INITIAL_COUNT;
            const sizeClass = img.size === "tall" ? "masonry-tall" : img.size === "short" ? "masonry-short" : "masonry-medium";
            return (
              <div class={cn("fade-in group cursor-pointer", isHidden && "hidden")} data-image-index={idx}>
                <div class={cn("relative overflow-hidden rounded-lg shadow-xl", sizeClass)}>
                  <img src={img.src} alt={img.alt} class={cn("w-full h-full object-cover", img.imgClass)} />
                  <div class="absolute inset-0 bg-gradient-to-t from-primary/80 to-transparent opacity-0 group-hover:opacity-100 transition-smooth flex items-end p-6">
                    <p class="text-white font-semibold">{img.caption}</p>
                  </div>
                  <div class="absolute inset-0 bg-gold/20 scale-0 group-hover:scale-100 transition-smooth"></div>
                </div>
              </div>
            );
          })}
        </div>
      ))}
    </div>

    <!-- View More Button -->
    {hasMore && (
      <div class="text-center mt-12 fade-in view-more-wrapper">
        <button id="viewMoreBtn" type="button" class="bg-gold text-dark px-8 py-4 rounded-lg font-semibold text-lg hover:bg-gold/90 transition-smooth hover:scale-105 inline-flex items-center gap-3 shadow-lg">
          <ImagesIcon size={24} weight="fill" />
          Lihat Lebih Banyak
        </button>
      </div>
    )}
  </div>

  <script>
    // Reveal all hidden gallery items and hide the button
    document.addEventListener('DOMContentLoaded', () => {
      const btn = document.getElementById('viewMoreBtn');
      const root = document.getElementById('gallery');
      const initialCount = Number(root?.getAttribute('data-initial-count') || '9');
      if (!btn) return;
      btn.addEventListener('click', () => {
        const items = document.querySelectorAll('[data-image-index]');
        items.forEach((el) => {
          const i = parseInt(el.getAttribute('data-image-index') || '0', 10);
          if (i >= initialCount) {
            el.classList.remove('hidden');
            // Trigger fade-in animation
            requestAnimationFrame(() => el.classList.add('show'));
          }
        });
        // Hide the button and remove wrapper to clear spacing
        const wrapper = btn.closest('.view-more-wrapper');
        if (wrapper) {
          wrapper.remove();
        } else {
          btn.classList.remove('inline-flex');
          btn.classList.add('hidden');
          btn.style.display = 'none';
        }
      });
    });
  </script>
</section>

<style>
  .bg-dark {
    background-color: var(--color-dark);
  }

  .text-cream {
    color: var(--color-cream);
  }

  .text-gold {
    color: var(--color-gold);
  }

  .bg-gold {
    background-color: var(--color-gold);
  }

  .text-dark {
    color: var(--color-dark);
  }

  .bg-primary {
    background-color: var(--color-primary);
  }

  /* Masonry Grid Layout */
  .masonry-grid {
    display: grid;
    grid-template-columns: repeat(1, 1fr);
    gap: 1.5rem;
  }

  @media (min-width: 768px) {
    .masonry-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .masonry-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  .masonry-column {
    display: flex;
    gap: 1.5rem;
    flex-direction: column;
  }

  /* Image Height Variations */
  .masonry-tall {
    height: 480px;
  }

  .masonry-medium {
    height: 320px;
  }

  .masonry-short {
    height: 240px;
  }

  @media (max-width: 768px) {
    .masonry-tall {
      height: 380px;
    }

    .masonry-medium {
      height: 280px;
    }

    .masonry-short {
      height: 220px;
    }
  }

  /* Image Styles */
  .masonry-grid img {
    transition: transform 0.3s ease;
  }

  .masonry-grid .group:hover img {
    transform: scale(1.05);
  }
</style>
